<div class="m-subheader" appunwraptag="">
  <div class="d-flex align-items-center">

    <div class="siam-page-header">
      <a class="siam-header-back-btn" href="/index"><i class="fa fa-angle-left"></i> Tableau de bord</a>
      <h2> Fiche Mouvement N° {{ mouvement.id }} </h2>
          </div>


  </div>
</div>
<div class="m-content" style="padding-bottom: 10px !important;">
  <div class="m-portlet m-portlet--bordered-semi m-portlet--full-height m-portlet--rounded ">
    <div class="m-portlet__body">




      <div class="tab-content" *ngIf="mouvement">
        <div class="tab-pane active" id="m_user_profile_tab_1">
          <div class="m-form m-form--fit">
            <div class="m-portlet__body">
              <div class="row">
                <div class="col-12">


                  <h3 class="m-form__section">
                    Informations générales

                    <span class="d-none d-sm-block" >

                        <span class="siam-form-input-value _status_inprogress " *ngIf="mouvement.state == 'inprogress'">
                        <i class="fa  fa-spinner" aria-hidden="true"></i> EN COURS
                      </span>


                        <span class="siam-form-input-value _status_done   " *ngIf="mouvement.state == 'done'">
                        <i class="fa  fa-check" aria-hidden="true"></i> VALIDÉ
                      </span>

                        <span class="siam-form-input-value _status_cancled " *ngIf="mouvement.state == 'canceled'">
                        <i class="fa  fa-times" aria-hidden="true"></i> ANNULÉ
                      </span>
                      <span   [appPermissionHidden]="['distributionCenter.stocks.change_status']" style="font-size: 12px; padding-left: 12px; cursor: pointer;" *ngIf="mouvement.state === 'done'"   > <a (click)="Scan()"> <i class="fa fa-refresh" aria-hidden="true"></i> <span style="text-decoration: underline;"> En cours </span> </a> </span>

                   </span>
                   </h3>

                  <div class="m-form__seperator m-form__seperator--dashed m-form__seperator--space-2x"></div>
                </div>
              </div>
              <div class="row">
                <div class="col-4">
                  <div class="row">
                    <label class="col-12">
                      Type
                    </label>
                    <div class="col-12">

                      <p class="siam-form-input-value siam-form-input-value-nodata">
                          {{ helper.orderType(mouvement.type).toUpperCase() }}
                      </p>

                    </div>
                  </div>

                </div>
                <div class="col-4">
                  <div class="row">
                    <label class="col-12">
                      N° Bon
                    </label>
                    <div class="col-12">

                      <p class="siam-form-input-value siam-form-input-value-nodata">
                        {{mouvement.bon_number}}
                      </p>
                    </div>
                  </div>

                </div>
                <div class="col-4">
                  <div class="row">
                    <label class="col-12">
                      Date
                    </label>
                    <div class="col-12">

                      <p class="siam-form-input-value siam-form-input-value-nodata">
                        <i class="fa fa-clock-o" aria-hidden="true"></i>
                        {{mouvement.date}}
                      </p>

                    </div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="row">
                    <label class="col-12">
                      Commande
                    </label>
                    <div class="col-12">

                      <p class="siam-form-input-value siam-form-input-value-nodata" *ngIf="order">
                        <i class="fa fa-shopping-cart" aria-hidden="true"></i> {{ order.object }}
                      </p>

                    </div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="row">
                    <label class="col-12">
                      Emetteur
                    </label>
                    <div class="col-12">

                      <p class="siam-form-input-value siam-form-input-value-nodata" *ngIf="from">

                        <i style="font-size: 150%; align-content: center; color: #ac2925;" class="fa fa-chevron-up fa-5x"></i> {{ from.name || from.full_name }}
                      </p>

                    </div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="row">
                    <label class="col-12">
                      Récepteur
                    </label>
                    <div class="col-12">

                      <p class="siam-form-input-value siam-form-input-value-nodata" *ngIf="to">
                        <i style="font-size: 150%; align-content: center; color: #0b9c8f;" class="fa fa-chevron-down fa-5x"></i> {{ to.name || to.full_name }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>






<div class="m-content" style="padding-bottom: 10px !important ;">
  <div class="m-portlet m-portlet--bordered-semi m-portlet--full-height m-portlet--rounded ">
    <div class="m-portlet__body">


      <div class="tab-content">
        <div class="tab-pane active" id="m_user_profile_tab_2">
          <div class="m-form m-form--fit">
            <div class="m-portlet__body">
              <div class="row">
                <div class="col-12">
                  <h3 class="m-form__section">
                    Liste des produits
                  </h3>
                  <div class="m-form__seperator m-form__seperator--dashed m-form__seperator--space-2x"></div>
                </div>
              </div>


              <dx-data-grid
                id="gridContainer"
                [dataSource]="articles"
                showBorders="true"
                [columnHidingEnabled]="true"
                [allowColumnResizing]="false"
                [allowColumnReordering]="true"
                [remoteOperations]="{ paging: true, sorting: true, filtering: true}"
                KeyExpr="id">

                <dxo-export [enabled]="true" fileName="magasin" [allowExportSelectedData]="true"></dxo-export>

                <dxo-filter-row [visible]="true"></dxo-filter-row>
                <dxo-header-filter [visible]="true"></dxo-header-filter>

                <dxo-group-panel [visible]="true"></dxo-group-panel>
                <dxo-scrolling mode="virtual"></dxo-scrolling>
                <dxo-editing
                  mode="popup"
                  [useIcons]="true"
                  [allowDeleting]="false"
                  [allowUpdating]="false"
                >
                </dxo-editing>
                <dxo-grouping [autoExpandAll]="false"></dxo-grouping>
                <dxo-selection mode="multiple"></dxo-selection>
                <dxo-header-filter [visible]="true"></dxo-header-filter>


                <dxo-pager
                  [allowedPageSizes]="[5, 8, 15, 30]"
                  [showInfo]="true"
                  [showNavigationButtons]="true"
                  [showPageSizeSelector]="true"
                  [visible]="true">
                </dxo-pager>
                <dxo-paging [pageSize]="10"></dxo-paging>
                <dxo-column-chooser [enabled]="true" mode="select"></dxo-column-chooser>

                <dxi-column dataField="article.id" [width]="100" caption="" [allowSorting]="false"  [allowFiltering]="false"  [allowSorting]="false"></dxi-column>
                <dxi-column dataField="article.category.article_category.name" caption="Famille"></dxi-column>
                <dxi-column dataField="article.category.name" caption="Sous Famille"></dxi-column>
                <dxi-column dataField="article.name" caption="Article"></dxi-column>
                <dxi-column dataField="quantity" caption="Quantité globale"></dxi-column>

              </dx-data-grid>


            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>

  <dx-popup
    class="popup"
    [width]="320"
    [height]="150"
    [showTitle]="true"
    title="Confirmation "
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    [(visible)]="popupDeliverVisible"
  >
    <div *dxTemplate="let data of 'content'">
      <p>
        Voulez-vous vraiment livrer cet élement ?
       </p>

      <div  class="pull-right">
      <dx-button class="pull-left"
        type="success"
        text="Oui"
        width="80"
        (onClick)="deliver()">
      </dx-button>
        &nbsp;
        &nbsp;

      <dx-button class="pull-right"
        class="button-info"
        text="No"
        width="80"
        (onClick)="cancelPopup()">
      </dx-button>
      </div>

    </div>
  </dx-popup>





<dx-popup
  class="popup"
  [width]="350"
  [height]="150"
  [showTitle]="true"
  title="Confirmation"
  [dragEnabled]="false"
  [closeOnOutsideClick]="true"
  [(visible)]="popupDeleteVisible"
>
  <div *dxTemplate="let data of 'content'">
    <p>
      Voulez-vous vraiment annuler cet élement ?
    </p>

    <div  class="pull-right">

    <dx-button class="pull-left"
               width="80"
               type="danger"
               text="Oui"
               (onClick)="delete()">
    </dx-button>


    <dx-button class="pull-right"
               class="button-info"
               width="80"
               text="No"
               (onClick)="cancelPopup()">
    </dx-button>
  </div>

  </div>
</dx-popup>







<div class="dx-fieldset" >
    <div class="dx-field">
    <div class="dx-field-value">
      <dx-button width="180" *ngIf="mouvement.state === 'inprogress'" icon="fa fa-paper-plane"  [appPermissionHidden]="['distributionCenter.stocks.validationOperation']" [visible]="(mouvement.type === 'transfer' && to.canValidate) || (mouvement.type !== 'transfer')" text="VALIDER" type="success"  style="margin-left: 20px; margin-right: 20px;" (onClick)="showDeliverPopup()"></dx-button>

      <dx-button width="150" class="d-none d-sm-block " *ngIf="mouvement.state === 'done'" icon="fa fa-print"  (onClick)="print()" text="IMPRIMER" type="primary"  style="margin-left: 20px; margin-right: 20px;" ></dx-button> &nbsp; &nbsp;

      <dx-button width="140" *ngIf="mouvement.state === 'inprogress'" icon="fa fa-trash"  text="ANNULER" type="danger"  (onClick)="showDeletePopup()"></dx-button> &nbsp; &nbsp;
 
    <!--  <dx-button width="140"  *ngIf="mouvement.state === 'done'"  icon="fa fa-refresh"  [appPermissionHidden]="['distributionCenter.stocks.validationOperation']"  text="ENCOURS" type="default"  style="margin-left: 20px; margin-right: 20px;"(onClick)="Scan()"></dx-button> !-->

    </div>
  </div>
</div>




 
  
<div name="popup" id="popup" #popup>
    <dx-popup
      class="popup"
      [width]="580"
      [height]="400"
      [showTitle]="true"
      title="Confirmation "
      [dragEnabled]="false"
      (onShown)="SearchByRfid()"
      [closeOnOutsideClick]="true"
      [(visible)]="popupRfidVisible"
      (window:keypress)="doSomething($event)"
    >
      <div *dxTemplate="let data of 'content'">
  
        <div class="gilsser">
          <h1>GLISSER LA CARTE</h1>
          <p>Faire glisser la carte sur le lecteur de carte pour changer le status</p>
          <div class="glisser-carte-agriculteur">
            <div class="credit-card">
              <div class="rfid-tripe"></div>
            </div>
            <div class="swiper-top"></div>
            <div class="swiper-bottom">
              <div class="light-indicator"></div>
            </div>
          </div>
        </div>
  
      </div>
    </dx-popup>
  
  </div>



  
  <input type="text" name="rfid" style="width: 0; height: 0;border: none;" #rfid>
  <input class="rfid-input" type="text" name="focusout" style="width: 0; height: 0;border: none;" #focusout>
  
  

  


<div style="display:none;">

    <div id="t1">
    <div id="receipt-wrapper"   >
        <div class="receipt-block">
            <div class="receipt-head">
                <div>BON DE {{ this.helper.orderType(this.mouvement.type).toUpperCase() }}</div>
            </div>

            <div style="text-align : center; margin-bottom: 10px;">
                <div>N° {{this.mouvement.id}}</div>
    
            </div>
    
            <div style="text-align : right;  margin-bottom: 5px; font-size:12px;">
                <div>La Date : {{this.mouvement.date }}</div>
            </div>
    
            <div style="text-align : right; margin-bottom: 10px; font-size:12px;">
                <div>{{this.mouvement.campaign}}</div>
            </div>
     
              <div class="receipt-info" *ngIf="this.mouvement.type != 'transfer' &&  this.mouvement.type != 'receive'  &&  this.mouvement.type != 'return'">

                <div >
                <div class="receipt-item">
                    <div class="receipt-item-lbl">CDA</div>
                    <div class="receipt-item-price">{{this.mouvement.cda}}</div>
                </div>
                <div class="receipt-item">
                    <div class="receipt-item-lbl">ZONE</div>
                    <div class="receipt-item-price">{{this.mouvement.zone }}</div>
                </div>
                <div class="receipt-item">
                    <div class="receipt-item-lbl">PARCELLE</div>
                    <div class="receipt-item-price">{{this.mouvement.parcel}}</div>
                </div>

                </div>
  
            </div>
    
            <div class="receipt-items"   *ngFor="let article of articles; let i = index"> 
              
       
                            <div class="receipt-item">
                                <div class="receipt-item-lbl" style="font-size:13px;"> {{article.article.name}}</div>
                                
                                <div class="receipt-item-price"> {{article.quantity}}  {{article.article.unit}}</div>
                           </div>
                   
            </div>

 

            <div class="receipt-info">

                  
                <div class="receipt-item">
                    <div class="receipt-item-lbl" style="font-size:13px;">Emetteur</div>
                    <div class="receipt-item-price"> &nbsp; {{this.mouvement.from.full_name }}</div>
                </div>
                <div class="receipt-item">
                    <div class="receipt-item-lbl" style="font-size:13px;">Récepteur</div>
                    <div class="receipt-item-price"> &nbsp; {{this.mouvement.to.name}}</div>
                </div>

            </div>

 
     
            <div class="signature" style="font-size:12px;">
                <div>**  **</div>
    
                <div>*  *</div>
    
                <div>-------------------------</div>
    
                <div>** MERCI **</div>
    
                <div>*****</div>
                <div>***</div>
    
            </div>
          
        </div>
    
        </div>
    
    
      </div>







   





